<!DOCTYPE html>
<html>
<head>
    <title>Waypoint Debug Test</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #00ff00; 
        }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; }
        .success { border-color: #00ff00; }
        .error { border-color: #ff0000; color: #ff0000; }
    </style>
</head>
<body>
    <h1>Waypoint System Debug Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'test ' + (isError ? 'error' : 'success');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
            console.log(message);
        }

        async function testMapboxAPI() {
            log('🧪 Testing Mapbox Directions API...');
            
            // Get token from localStorage (like the app does)
            const token = localStorage.getItem('mapbox-token') || 'pk.YOUR_TOKEN_HERE';
            
            if (!token || token === 'pk.YOUR_TOKEN_HERE') {
                log('❌ No Mapbox token found in localStorage', true);
                return;
            }
            
            log('✅ Token found: ' + token.substring(0, 20) + '...');
            
            // Test simple 2-waypoint route (Sydney to Melbourne)
            const coords = '151.2093,-33.8688;144.9631,-37.8136';  // Sydney to Melbourne
            const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${coords}?` + 
                       `access_token=${token}&geometries=geojson&steps=true&overview=full`;
            
            log('🚀 Testing simple route: Sydney to Melbourne');
            log('URL: ' + url.substring(0, 80) + '...');
            
            try {
                const response = await fetch(url);
                log('📡 API Response status: ' + response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    log('❌ API Error: ' + errorText, true);
                    return;
                }
                
                const data = await response.json();
                log('✅ API Success! Code: ' + data.code);
                
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    log('📏 Route distance: ' + (route.distance / 1000).toFixed(1) + ' km');
                    log('⏱️ Route duration: ' + Math.round(route.duration / 60) + ' minutes');
                    log('🗺️ Coordinates count: ' + route.geometry.coordinates.length);
                    log('✅ Magnetic routing should work for this route!');
                } else {
                    log('❌ No routes returned', true);
                }
                
            } catch (error) {
                log('❌ Fetch error: ' + error.message, true);
            }
        }

        // Run test when page loads
        setTimeout(() => {
            testMapboxAPI();
        }, 1000);
    </script>
</body>
</html>